SET citus.superuser TO 'postgres';
set citus.enable_create_database_propagation=on;
create database test_alter_db_from_nonmain_db;
create database altered_database;
reset citus.enable_create_database_propagation;
\c regression;
set citus.enable_create_database_propagation=on;
\c test_alter_db_from_nonmain_db
set citus.log_remote_commands = true;
set citus.grep_remote_commands = "%ALTER DATABASE%";
alter database altered_database rename to altered_database_renamed;
alter database altered_database_renamed rename to altered_database;
alter database altered_database with
    ALLOW_CONNECTIONS false
    CONNECTION LIMIT 1
    IS_TEMPLATE true;
NOTICE:  issuing SELECT citus_internal.execute_command_on_remote_nodes_as_user('ALTER DATABASE altered_database WITH ALLOW_CONNECTIONS false CONNECTION LIMIT 1 IS_TEMPLATE true;', 'postgres')
DETAIL:  on server postgres@localhost:xxxxx connectionId: xxxxxxx
alter database altered_database with
    ALLOW_CONNECTIONS true
    CONNECTION LIMIT 0
    IS_TEMPLATE false;
NOTICE:  issuing SELECT citus_internal.execute_command_on_remote_nodes_as_user('ALTER DATABASE altered_database WITH ALLOW_CONNECTIONS true CONNECTION LIMIT 0 IS_TEMPLATE false;', 'postgres')
DETAIL:  on server postgres@localhost:xxxxx connectionId: xxxxxxx
\c regression
create role test_owner_non_main_db;
\c test_alter_db_from_nonmain_db
set citus.log_remote_commands = true;
set citus.grep_remote_commands = "%ALTER DATABASE%";
set citus.enable_create_database_propagation=on;
alter database altered_database owner to test_owner_non_main_db;
alter database altered_database owner to CURRENT_USER;
alter database altered_database set default_transaction_read_only = true;
NOTICE:  issuing SELECT citus_internal.execute_command_on_remote_nodes_as_user('ALTER DATABASE altered_database SET default_transaction_read_only = ''true''', 'postgres')
DETAIL:  on server postgres@localhost:xxxxx connectionId: xxxxxxx
set default_transaction_read_only = false;
alter database altered_database set default_transaction_read_only from current;
NOTICE:  issuing SELECT citus_internal.execute_command_on_remote_nodes_as_user('ALTER DATABASE altered_database SET default_transaction_read_only FROM CURRENT', 'postgres')
DETAIL:  on server postgres@localhost:xxxxx connectionId: xxxxxxx
alter database altered_database set default_transaction_read_only to DEFAULT;
NOTICE:  issuing SELECT citus_internal.execute_command_on_remote_nodes_as_user('ALTER DATABASE altered_database SET default_transaction_read_only TO DEFAULT', 'postgres')
DETAIL:  on server postgres@localhost:xxxxx connectionId: xxxxxxx
alter database altered_database RESET default_transaction_read_only;
NOTICE:  issuing SELECT citus_internal.execute_command_on_remote_nodes_as_user('ALTER DATABASE altered_database RESET default_transaction_read_only', 'postgres')
DETAIL:  on server postgres@localhost:xxxxx connectionId: xxxxxxx
alter database altered_database SET TIME ZONE '-7';
NOTICE:  issuing SELECT citus_internal.execute_command_on_remote_nodes_as_user('ALTER DATABASE altered_database SET timezone = ''-7''', 'postgres')
DETAIL:  on server postgres@localhost:xxxxx connectionId: xxxxxxx
alter database altered_database set TIME ZONE LOCAL;
NOTICE:  issuing SELECT citus_internal.execute_command_on_remote_nodes_as_user('ALTER DATABASE altered_database SET timezone TO DEFAULT', 'postgres')
DETAIL:  on server postgres@localhost:xxxxx connectionId: xxxxxxx
alter database altered_database set TIME ZONE DEFAULT;
NOTICE:  issuing SELECT citus_internal.execute_command_on_remote_nodes_as_user('ALTER DATABASE altered_database SET timezone TO DEFAULT', 'postgres')
DETAIL:  on server postgres@localhost:xxxxx connectionId: xxxxxxx
alter database altered_database RESET TIME ZONE;
NOTICE:  issuing SELECT citus_internal.execute_command_on_remote_nodes_as_user('ALTER DATABASE altered_database RESET timezone', 'postgres')
DETAIL:  on server postgres@localhost:xxxxx connectionId: xxxxxxx
alter database altered_database SET TIME ZONE INTERVAL '-08:00' HOUR TO MINUTE;
NOTICE:  issuing SELECT citus_internal.execute_command_on_remote_nodes_as_user('ALTER DATABASE altered_database SET TIME ZONE INTERVAL ''@ 8 hours ago''', 'postgres')
DETAIL:  on server postgres@localhost:xxxxx connectionId: xxxxxxx
alter database altered_database RESET TIME ZONE;
NOTICE:  issuing SELECT citus_internal.execute_command_on_remote_nodes_as_user('ALTER DATABASE altered_database RESET timezone', 'postgres')
DETAIL:  on server postgres@localhost:xxxxx connectionId: xxxxxxx
alter database altered_database set default_transaction_isolation = 'serializable';
NOTICE:  issuing SELECT citus_internal.execute_command_on_remote_nodes_as_user('ALTER DATABASE altered_database SET default_transaction_isolation = ''serializable''', 'postgres')
DETAIL:  on server postgres@localhost:xxxxx connectionId: xxxxxxx
set default_transaction_isolation = 'read committed';
alter database altered_database set default_transaction_isolation from current;
NOTICE:  issuing SELECT citus_internal.execute_command_on_remote_nodes_as_user('ALTER DATABASE altered_database SET default_transaction_isolation FROM CURRENT', 'postgres')
DETAIL:  on server postgres@localhost:xxxxx connectionId: xxxxxxx
alter database altered_database set default_transaction_isolation to DEFAULT;
NOTICE:  issuing SELECT citus_internal.execute_command_on_remote_nodes_as_user('ALTER DATABASE altered_database SET default_transaction_isolation TO DEFAULT', 'postgres')
DETAIL:  on server postgres@localhost:xxxxx connectionId: xxxxxxx
alter database altered_database RESET default_transaction_isolation;
NOTICE:  issuing SELECT citus_internal.execute_command_on_remote_nodes_as_user('ALTER DATABASE altered_database RESET default_transaction_isolation', 'postgres')
DETAIL:  on server postgres@localhost:xxxxx connectionId: xxxxxxx
alter database altered_database set statement_timeout = 1000;
NOTICE:  issuing SELECT citus_internal.execute_command_on_remote_nodes_as_user('ALTER DATABASE altered_database SET statement_timeout = 1000', 'postgres')
DETAIL:  on server postgres@localhost:xxxxx connectionId: xxxxxxx
set statement_timeout = 2000;
alter database altered_database set statement_timeout from current;
NOTICE:  issuing SELECT citus_internal.execute_command_on_remote_nodes_as_user('ALTER DATABASE altered_database SET statement_timeout FROM CURRENT', 'postgres')
DETAIL:  on server postgres@localhost:xxxxx connectionId: xxxxxxx
alter database altered_database set statement_timeout to DEFAULT;
NOTICE:  issuing SELECT citus_internal.execute_command_on_remote_nodes_as_user('ALTER DATABASE altered_database SET statement_timeout TO DEFAULT', 'postgres')
DETAIL:  on server postgres@localhost:xxxxx connectionId: xxxxxxx
alter database altered_database RESET statement_timeout;
NOTICE:  issuing SELECT citus_internal.execute_command_on_remote_nodes_as_user('ALTER DATABASE altered_database RESET statement_timeout', 'postgres')
DETAIL:  on server postgres@localhost:xxxxx connectionId: xxxxxxx
alter database altered_database set lock_timeout = 1201.5;
NOTICE:  issuing SELECT citus_internal.execute_command_on_remote_nodes_as_user('ALTER DATABASE altered_database SET lock_timeout = 1201.5', 'postgres')
DETAIL:  on server postgres@localhost:xxxxx connectionId: xxxxxxx
set lock_timeout = 1202.5;
alter database altered_database set lock_timeout from current;
NOTICE:  issuing SELECT citus_internal.execute_command_on_remote_nodes_as_user('ALTER DATABASE altered_database SET lock_timeout FROM CURRENT', 'postgres')
DETAIL:  on server postgres@localhost:xxxxx connectionId: xxxxxxx
alter database altered_database set lock_timeout to DEFAULT;
NOTICE:  issuing SELECT citus_internal.execute_command_on_remote_nodes_as_user('ALTER DATABASE altered_database SET lock_timeout TO DEFAULT', 'postgres')
DETAIL:  on server postgres@localhost:xxxxx connectionId: xxxxxxx
alter database altered_database RESET lock_timeout;
NOTICE:  issuing SELECT citus_internal.execute_command_on_remote_nodes_as_user('ALTER DATABASE altered_database RESET lock_timeout', 'postgres')
DETAIL:  on server postgres@localhost:xxxxx connectionId: xxxxxxx
ALTER DATABASE altered_database RESET ALL;
NOTICE:  issuing SELECT citus_internal.execute_command_on_remote_nodes_as_user('ALTER DATABASE altered_database RESET ALL', 'postgres')
DETAIL:  on server postgres@localhost:xxxxx connectionId: xxxxxxx
\c regression
set citus.enable_create_database_propagation=on;
drop database altered_database;
drop database test_alter_db_from_nonmain_db;
reset citus.enable_create_database_propagation;
drop role test_owner_non_main_db;
